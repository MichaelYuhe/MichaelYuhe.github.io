# 图片懒加载




# 懒加载

## 什么是懒加载

懒加载就是延时加载，也称为按需加载

## 具体表现

懒加载最常用于图片。当用户访问页面时，先将图片的路径用占位图的路径代替，这样就只需要请求一张占位图。而当图片进入了可视区域，才把图片的路径替换成真正的路径，从而重新获取真正的图片。

## 图片懒加载技术原理

- 图片地址不存放在`src`属性中，而是存放在某个自定义属性，如`data-src`中
- 页面加载完成后，根据`scrollTop`来判断图片是否在视野范围内，如果在，就取出路径存放到`src`属性中，浏览器就会发请求去下载图片
- 需要监听滚动事件，重复判断图片是否在视野范围内

## 如何实现

### 原生JS实现

- 首先，每个`img`标签都要有自定义属性`data-src`来存放路径
- 获取浏览器视口高度
  - `window.innerHeight`
- 获取图片离顶部的距离
  - `getBoundingClientRect()`
  - `scrollTop`
- 监听`scroll`和`resize`事件
  - 滚动时判断是否在可视范围，可以加上防抖防止频繁调用
  - 窗口大小变化要重新计算视口高度，同样也可以加防抖优化一下

### node module

用React或者Vue框架时，也可以像上述方法去实现，但没有必要重复造轮子，有许多库可以直接调用

`react-lazy-load`、`react-lazy-mount`、`vue-lazyload`

### 自定义指令

除此之外，还可以用自定义指令的方式来做(Vue)

就拿我自己做的音乐播放器来说，要获取很多音乐的专辑封面、歌手照片，自然就需要用到懒加载，我当时的实现方式是采用了自定义指令的方法，原理也是完全一致的


